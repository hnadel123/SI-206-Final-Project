# Weathering the Wait Time Project
# SI 206 Final Project
# Authors: Nadia Reddin, Hannah Nadel

import requests
import time
import sqlite3
from datetime import datetime
import matplotlib.pyplot as plt

from hannah import *
from Nadia import *


NAME = 'weathering_the_wait_time.db'


def create_tables():
    conn = sqlite3.connect(NAME)
    cur = conn.cursor()

    cur.execute('''CREATE TABLE IF NOT EXISTS DisneylandRides (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        ride_name TEXT,
        wait_time INTEGER,
        ride_status TEXT,
        ride_type TEXT,
        timestamp TEXT
    )''')

    
    cur.execute('''CREATE TABLE IF NOT EXISTS Weather (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        temperature REAL,
        condition TEXT,
        wind_speed REAL,
        humidity REAL,
        precipitation REAL,
        timestamp TEXT
    )''')

    cur.execute('''CREATE TABLE IF NOT EXISTS CombinedData (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        ride_name TEXT,
        wait_time INTEGER,
        temperature REAL,
        condition TEXT,
        timestamp TEXT
    )''')

    conn.commit()
    conn.close()



def combine_data():
    conn = sqlite3.connect(NAME)
    cur = conn.cursor()

    cur.execute('''
        INSERT INTO CombinedData (ride_name, wait_time, temperature, condition, timestamp)
        SELECT DR.ride_name, DR.wait_time, W.temperature, W.condition, DR.timestamp
        FROM DisneylandRides AS DR
        JOIN Weather AS W
        ON DR.timestamp = W.timestamp;
    ''')

    conn.commit()
    conn.close()


def main():
    create_tables()
    fetch_disneyland_data()
    fetch_weather_data()
    combine_data()


if __name__ == '__main__':
    main()
