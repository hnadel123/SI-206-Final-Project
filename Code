# Weathering the Wait Time Project
# SI 206 Final Project
# Authors: Nadia Reddin, Hannah Nadel

import requests
import time
import sqlite3
from datetime import datetime
import matplotlib.pyplot as plt

from hannah import *
from Nadia import *


NAME = 'weathering_the_wait_time.db'


def create_tables():
    conn = sqlite3.connect(NAME)
    cur = conn.cursor()

    cur.execute('''CREATE TABLE IF NOT EXISTS DisneylandRides (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        ride_name TEXT,
        wait_time INTEGER,
        ride_status TEXT,
        ride_type TEXT,
        timestamp TEXT
    )''')

    cur.execute('''CREATE TABLE IF NOT EXISTS Weather (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        temperature REAL,
        condition TEXT,
        humidity REAL,
        precipitation REAL,
        timestamp TEXT
    )''')

    cur.execute('''CREATE TABLE IF NOT EXISTS CombinedData (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        ride_name TEXT,
        wait_time INTEGER,
        temperature REAL,
        condition TEXT,
        timestamp TEXT
    )''')

    conn.commit()
    conn.close()


def main():
    create_tables()
    timestamp = time.strftime('%Y-%m-%d %H:00:00')
    fetch_disneyland_data(timestamp)
    fetch_weather_data(timestamp)
    combine_data(timestamp)
    plot_wait_times_vs_temperature()

if __name__ == '__main__':
    main()
